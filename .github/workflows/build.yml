name: Build Kernel for SM-G988B (Exynos990)

on:
workflow_dispatch:

jobs:
build:
runs-on: ubuntu-latest
timeout-minutes: 90  # زيادة وقت التنفيذ

steps:  
- name: سحب ملفات المشروع  
  uses: actions/checkout@v4  

- name: تثبيت المتطلبات  
  run: |  
    sudo apt update  
    sudo apt install -y bc bison build-essential ccache curl flex git libncurses-dev libssl-dev python3 unzip wget xz-utils  

- name: تنظيف البيئة  
  run: |  
    rm -rf kernel toolchain  

- name: استنساخ مصدر النواة  
  run: |  
    git clone --depth=1 --branch main https://github.com/usama19931993/exynos990-kernel1.git kernel  

- name: إضافة KernelSU  
  run: |  
    cd kernel  
    git clone --depth=1 https://github.com/tiann/KernelSU.git  
    mv KernelSU/kernel drivers/kernelsu  
    rm -rf KernelSU  
    echo 'source "drivers/kernelsu/Kconfig"' >> drivers/Kconfig  

- name: إعداد أداة التجميع (Toolchain)  
  run: |  
    # المحاولة مع روابط بديلة  
    git clone --depth=1 https://github.com/LineageOS/android_prebuilts_gcc_linux-x86_aarch64_aarch64-linux-android-4.9.git toolchain || \  
    git clone --depth=1 https://github.com/bgcngm/aarch64-linux-android-4.9.git toolchain || \  
    git clone --depth=1 git://github.com/bgcngm/aarch64-linux-android-4.9.git toolchain  
      
    if [ -d "toolchain" ]; then  
      echo "$PWD/toolchain/bin" >> $GITHUB_PATH  
      echo "CROSS_COMPILE=$PWD/toolchain/bin/aarch64-linux-android-" >> $GITHUB_ENV  
      echo "PATH=$PWD/toolchain/bin:$PATH" >> $GITHUB_ENV  
    else  
      echo "❌ فشل في الحصول على أداة التجميع!"  
      exit 1  
    fi  

- name: تهيئة ccache  
  run: |  
    echo "/usr/bin/ccache" >> $GITHUB_PATH  
    echo "CCACHE_DIR=$GITHUB_WORKSPACE/ccache" >> $GITHUB_ENV  
    mkdir -p $GITHUB_WORKSPACE/ccache

