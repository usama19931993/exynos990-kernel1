name: Step 2 - Unpack boot.img

on:
  workflow_dispatch:

jobs:
  unpack:
    runs-on: ubuntu-latest

    steps:
    - name: Set up job
      run: echo "üöÄ Starting unpack step..."

    - name: Download working MagiskBoot binary (x86_64)
      run: |
        curl -Lo magiskboot https://raw.githubusercontent.com/azwhikaru/magiskboot_static/main/x86_64/magiskboot
        chmod +x magiskboot
        sudo mv magiskboot /usr/local/bin/magiskboot

    - name: Download and unzip boot-original.zip
      run: |
        wget -q https://github.com/usama19931993/exynos990-kernel1/releases/download/boot-original/boot-original.zip
        unzip -o boot-original.zip
        ls -lh boot.img

    - name: Unpack boot.img using MagiskBoot
      run: |
        magiskboot unpack boot.img
        if [ -f kernel ] && [ -f ramdisk.cpio ]; then
          echo "‚úÖ Unpacked boot.img successfully"
          ls -lh kernel ramdisk.cpio
        else
          echo "‚ùå Failed to unpack boot.img"
          ls -l
          exit 1
        fi